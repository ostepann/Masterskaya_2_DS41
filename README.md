# Описание проекта

## Задача
Интернет-магазин собирает историю покупок клиентов, проводит рекламные рассылки и планирует будущие продажи. Для оптимизации маркетинговых процессов необходимо выделить пользователей, которые с высокой вероятностью совершат покупку в ближайшие 90 дней.

**Цель проекта**: Построить модель машинного обучения, которая предскажет вероятность покупки клиентом в течение 90 дней.

---

## Данные
В проекте использовались следующие данные:
1. **apparel-purchases**: История покупок клиентов (6 столбцов, 202 208 записей).
2. **apparel-messages**: История рекламных рассылок (7 столбцов, 12 739 798 записей).
3. **apparel-target_binary**: Целевая переменная — совершит ли клиент покупку в течение следующих 90 дней (2 столбца, 49 849 записей). Выборка несбалансирована: только 2% клиентов совершили покупки.
4. **full_campaign_daily_event**: Ежедневные рекламные кампании (24 столбца, 131 072 записи).
5. **full_campaign_daily_event_channel**: Каналы распространения ежедневных рекламных кампаний (36 столбцов, 131 072 записи).

---

## Признаки для модели
### На основе **apparel-purchases**:
- 20 столбцов с самыми частыми категориями покупок.
- `days_after_first_purchase`: Число дней после первой покупки.
- `days_after_last_purchase`: Число дней после последней покупки.
- `purchase_count`: Число совершенных покупок.
- `avg_purchase_price`: Средняя цена покупки.

### На основе **apparel-messages**:
- Колонки `event` и `channel` были объединены, и выделены наиболее значимые события:
  - `send_email`
  - `send_mobile_push`
  - `open_mobile_push`
  - `click_mobile_push`
- Для этих событий созданы колонки в `apparel-target_binary`, заполненные числом соответствующих событий для каждого клиента.
- На основе поля `data` в `apparel-target_binary` созданы колонки:
  - `days_after_first_message`: Число дней после первого сообщения.
  - `days_after_last_message`: Число дней после последнего сообщения.

### На основе **full_campaign_daily_event**:
- `count_purchase`
- `count_click`
- `count_soft_bounce`
- `count_subscribe`

### На основе **full_campaign_daily_event_channel**:
- `count_purchase_email`
- `count_click_email`
- `count_open_email`
- `count_send_email`
- `count_hbq_spam_email`

### Исключенные признаки:
На основе матрицы корреляции (метод Спирмена, так как распределение признаков не нормальное) были исключены колонки:
- `days_after_first_purchase`
- `count_open_email`
- `count_click_email`
- `count_hbq_spam_email`

Эти признаки имели высокую корреляцию с другими, что могло привести к мультиколлинеарности.

---

## Модели
Для построения модели использовались следующие алгоритмы:
- **CatBoostClassifier**
- **LGBMClassifier**
- **RandomForestClassifier**

### Метрика ROC-AUC на тестовой выборке:
- CatBoostClassifier: **0.6993**
- LGBMClassifier: **0.7238**
- RandomForestClassifier: **0.7244**

---

## Оптимизация модели
### Сокращение числа признаков
На основе анализа важности признаков с использованием SHAP число признаков было сокращено до 20. Результаты на тестовой выборке:
- CatBoostClassifier: **0.7213**
- LGBMClassifier: **0.7228**
- RandomForestClassifier: **0.7245**

### Дополнительные эксперименты
- **Масштабирование признаков**: Не привело к улучшению метрики.
- **SMOTE для балансировки классов**: Ухудшило качество модели.

В итоге было решено отказаться от этих методов.

---

## Итоги
- Лучшая модель: **RandomForestClassifier** с ROC-AUC **0.7245**.
- Количество финальных признаков: **20**.
- Основные значимые признаки: `days_after_last_purchase`, `click_mobile_push`, `days_after_last_message`, `open_mobile_push`, `purchase_count`.

---

## Рекомендации
1. Уделить больше внимания клиентам, которые давно не совершали покупки (`days_after_last_purchase`).
2. Оптимизировать рекламные рассылки через мобильные push-уведомления, так как события `click_mobile_push` и `open_mobile_push` имеют значительное влияние на вероятность покупки.
3. Учитывать среднюю цену покупки и количество покупок для сегментации клиентов.

---

## Дальнейшие шаги
- Провести A/B-тестирование для проверки эффективности рекомендаций.
- Исследовать возможность улучшения модели с учетом временных особенностей данных (например, сезонность покупок).
